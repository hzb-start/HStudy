# Linux环境搭建

操作系统：Centos7

软件：VMware（用来模拟电脑硬件环境）



> 安装Centos7

步骤见：**安装Centos7（两种方式）**文件夹

安装好后，暂时先关机



> 规划windows和虚拟机的ip

|           | 网关        | ip            |
| --------- | ----------- | ------------- |
| windows   | 192.168.2.1 | 192.168.2.2   |
| bigdata01 | 192.168.2.1 | 192.168.2.128 |
| bigdata02 | 192.168.2.1 | 192.168.2.129 |
| bigdata03 | 192.168.2.1 | 192.168.2.130 |



> 虚拟网络编辑器配置

![](虚拟网络编辑器设置\1.png)



![](虚拟网络编辑器设置\2.png)



![](虚拟网络编辑器设置\3.png)



![](虚拟网络编辑器设置\4.png)



![](虚拟网络编辑器设置\5.png)



> 本地更改适配器设置（设置windows的ip）

![](本地更改适配器设置\1.png)



![](本地更改适配器设置\2.png)



![](本地更改适配器设置\3.png)



![](本地更改适配器设置\4.png)



![](本地更改适配器设置\5.png)



>虚拟机开机，root用户进入

先来查看一下主机名，并修改

```bash
# 查看主机
hostname
```

```bash
# 修改主机名
hostnamectl set-hostname bigdata01
```




> 设置虚拟机的ip

```bash
# 查看网卡的名字
cd /etc/sysconfig/network-scripts/
ls

# 编辑网卡（版本不一样，可能网卡配置的文件名不一样）
vi ifcfg-ens33

# 或直接执行下面的命令
vi /etc/sysconfig/network-scripts/ifcfg-ens33
```

需要修改或增加的地方用**-----------------------------------------**标记（实操中不需添加**-----------------------------------------**）

注释：设置成功后，保存并退出（按完esc键后按:wq）

```
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
-----------------------------------------BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens33
UUID=82da2189-2299-48e9-a18a-9ae9a5216e3c
DEVICE=ens33
-----------------------------------------ONBOOT=yes
-----------------------------------------IPADDR=192.168.2.128
-----------------------------------------GATEWAY=192.168.2.1
-----------------------------------------BROADCAST=192.168.2.255
-----------------------------------------DNS1=114.114.114.114
-----------------------------------------DNS2=8.8.8.8
```



> 配置网络服务

在虚拟机中分别执行以下命令

```bash
service NetworkManager stop

/etc/init.d/network restart

chkconfig NetworkManager off
```

```bash
# 追加本地网关
vi /etc/resolv.conf

# Generated by NetworkManager
nameserver 192.168.2.1
nameserver 114.114.114.114
nameserver 8.8.8.8
```

```bash
# 重启网关
systemctl restart network
```



>测试ping

```bash
[root@localhost /]# ping www.baidu.com
PING www.a.shifen.com (39.156.66.18) 56(84) bytes of data.
64 bytes from 39.156.66.18 (39.156.66.18): icmp_seq=1 ttl=128 time=15.1 ms
64 bytes from 39.156.66.18 (39.156.66.18): icmp_seq=2 ttl=128 time=14.8 ms
64 bytes from 39.156.66.18 (39.156.66.18): icmp_seq=3 ttl=128 time=14.5 ms
64 bytes from 39.156.66.18 (39.156.66.18): icmp_seq=4 ttl=128 time=14.5 ms
64 bytes from 39.156.66.18 (39.156.66.18): icmp_seq=5 ttl=128 time=14.6 ms
64 bytes from 39.156.66.18 (39.156.66.18): icmp_seq=6 ttl=128 time=14.6 ms

ctrl+C 即可终止
```



> 增加映射域名

类似于访问域名：www.baidu.com和访问ip地址：http://202.108.22.5是一样的（百度的ip可能会更改，笔记：2020.9.8）

192.168.2.128——bigdata01

**在虚拟机中执行**

```bash
vi /etc/hosts
```

增加映射192.168.2.128 bigdata01

```
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.2.128 bigdata01
```

**在windows中也需要增加映射**

```
C:\Windows\System32\drivers\etc

打开hosts文件，增加映射


...
# localhost name resolution is handled within DNS itself.
#	127.0.0.1       localhost
#	::1             localhost

192.168.2.128 bigdata01
192.168.2.129 bigdata02
192.168.2.130 bigdata03
```



> 克隆

- 需要删除UUID，更改IPADDR

```bash
vi /etc/sysconfig/network-scripts/ifcfg-ens33
```

```
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=ens33
-----------------------------------------删除UUID=82da2189-2299-48e9-a18a-9ae9a5216e3c
DEVICE=ens33
ONBOOT=yes
-----------------------------------------更改IPADDR=192.168.2.129/130
GATEWAY=192.168.2.1
BROADCAST=192.168.2.255
DNS1=114.114.114.114
DNS2=8.8.8.8
```

- 需要增加域名映射（三台虚拟机均需增加）

```bash
vi /etc/hosts
```

```
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.2.128 bigdata01
192.168.2.129 bigdata02
192.168.2.130 bigdata03
```



> 配置SSH（免密钥登录）

如果不配置则出现下面的情况（需要密码）

```
[root@bigdata02 ~]# ssh bigdata01
The authenticity of host 'bigdata01 (192.168.2.128)' can't be established.
ECDSA key fingerprint is SHA256:sjDBvXnYdZzOkGdmhLt4THa9/pE1TrvVT6E2ia2rOOA.
ECDSA key fingerprint is MD5:92:32:b1:16:7d:29:07:5c:18:63:4b:be:04:d8:8e:45.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'bigdata01,192.168.2.128' (ECDSA) to the list of known hosts.
root@bigdata01's password: 
```

设置三个节点之间的免密钥登录

**各个节点生成密钥（包括私钥和公钥）**

```bash
ssh-keygen -t rsa
```

**私钥留给自己**

```bash
ssh-copy-id localhost
```

```
[root@bigdata01 ~]# ssh-copy-id localhost
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
The authenticity of host 'localhost (::1)' can't be established.
ECDSA key fingerprint is SHA256:sjDBvXnYdZzOkGdmhLt4THa9/pE1TrvVT6E2ia2rOOA.
ECDSA key fingerprint is MD5:92:32:b1:16:7d:29:07:5c:18:63:4b:be:04:d8:8e:45.
Are you sure you want to continue connecting (yes/no)? yes
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@localhost's password: 

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'localhost'"
and check to make sure that only the key(s) you wanted were added.

```

**公钥发给别人（三个虚拟机分别执行）**

```bash
ssh-copy-id 别人的ip地址
```

```
[root@bigdata01 ~]# ssh-copy-id bigdata02
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@bigdata02's password: 

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'bigdata02'"
and check to make sure that only the key(s) you wanted were added.

[root@bigdata01 ~]# ssh-copy-id bigdata03
/usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: "/root/.ssh/id_rsa.pub"
The authenticity of host 'bigdata03 (192.168.2.130)' can't be established.
ECDSA key fingerprint is SHA256:sjDBvXnYdZzOkGdmhLt4THa9/pE1TrvVT6E2ia2rOOA.
ECDSA key fingerprint is MD5:92:32:b1:16:7d:29:07:5c:18:63:4b:be:04:d8:8e:45.
Are you sure you want to continue connecting (yes/no)? yes
/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
/usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
root@bigdata03's password: 

Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'bigdata03'"
and check to make sure that only the key(s) you wanted were added.
```

**测试（无需密码即可登录）**

```
ssh ip或域名
```

